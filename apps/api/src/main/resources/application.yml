spring:
  application:
    name: briefy-api

  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/briefy}
    username: ${DB_USER:briefy}
    password: ${DB_PASSWORD:briefy}

  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

  ai:
    model:
      chat: ${LLM_PROVIDER:none}
      embedding: none
      image: none
    zhipuai:
      api-key: ${ZHIPUAI_API_KEY:${LLM_API_KEY:}}
      base-url: ${ZHIPUAI_BASE_URL:https://api.z.ai/api/paas}
      chat:
        api-key: ${ZHIPUAI_CHAT_API_KEY:${ZHIPUAI_API_KEY:${LLM_API_KEY:}}}
        base-url: ${ZHIPUAI_CHAT_BASE_URL:${ZHIPUAI_BASE_URL:https://api.z.ai/api/paas}}
        options:
          model: ${ZHIPUAI_CHAT_MODEL:glm-4.7-flash}
    minimax:
      api-key: ${MINIMAX_API_KEY:}
      chat:
        api-key: ${MINIMAX_CHAT_API_KEY:${MINIMAX_API_KEY:}}
        options:
          model: ${MINIMAX_CHAT_MODEL:MiniMax-M2.5}
    google:
      genai:
        api-key: ${GOOGLE_GENAI_API_KEY:}
    chat:
      observations:
        log-prompt: ${SPRING_AI_CHAT_OBSERVATIONS_LOG_PROMPT:true}
        log-completion: ${SPRING_AI_CHAT_OBSERVATIONS_LOG_COMPLETION:true}
    embedding:
      observations:
        log-query-response: ${SPRING_AI_EMBEDDING_OBSERVATIONS_LOG_QUERY_RESPONSE:true}

server:
  port: ${SERVER_PORT:8081}

auth:
  jwt:
    secret: ${JWT_SECRET:dev-secret-change-me-dev-secret-change-me}
    access-token-minutes: ${JWT_ACCESS_TOKEN_MINUTES:15}
  refresh-token:
    days: ${JWT_REFRESH_TOKEN_DAYS:30}
  cookie:
    secure: ${AUTH_COOKIE_SECURE:false}
    same-site: ${AUTH_COOKIE_SAME_SITE:Lax}

security:
  encryption-key: ${ENCRYPTION_KEY:MDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWY=}

extraction:
  firecrawl:
    base-url: ${FIRECRAWL_BASE_URL:https://api.firecrawl.dev}
    wait-for-ms: ${FIRECRAWL_WAIT_FOR_MS:1000}
    agent:
      model: ${FIRECRAWL_AGENT_MODEL:spark-1-mini}
      poll-interval-ms: ${FIRECRAWL_AGENT_POLL_INTERVAL_MS:500}
      max-wait-ms: ${FIRECRAWL_AGENT_MAX_WAIT_MS:45000}
      max-credits: ${FIRECRAWL_AGENT_MAX_CREDITS:0}
  x-api:
    base-url: ${X_API_BASE_URL:https://api.x.com}
    timeout-ms: ${X_API_TIMEOUT_MS:10000}
    thread-max-results: ${X_API_THREAD_MAX_RESULTS:100}
  youtube:
    enabled: ${YOUTUBE_EXTRACTION_ENABLED:true}
    yt-dlp-path: ${YOUTUBE_YT_DLP_PATH:yt-dlp}
    ffmpeg-path: ${YOUTUBE_FFMPEG_PATH:ffmpeg}
    max-duration-seconds: ${YOUTUBE_MAX_DURATION_SECONDS:7200}
    command-timeout-seconds: ${YOUTUBE_COMMAND_TIMEOUT_SECONDS:180}
    worker:
      poll-ms: ${YOUTUBE_WORKER_POLL_MS:5000}
      batch-size: ${YOUTUBE_WORKER_BATCH_SIZE:5}
      max-attempts: ${YOUTUBE_WORKER_MAX_ATTEMPTS:5}
      processing-timeout-seconds: ${YOUTUBE_WORKER_PROCESSING_TIMEOUT_SECONDS:900}
      lock-heartbeat-ms: ${YOUTUBE_WORKER_LOCK_HEARTBEAT_MS:30000}

transcription:
  openai:
    api-key: ${TRANSCRIPTION_OPENAI_API_KEY:${OPENAI_API_KEY:}}
    model: ${TRANSCRIPTION_OPENAI_MODEL:whisper-1}

google:
  auth:
    enabled: ${GOOGLE_AUTH_ENABLED:false}
    client-id: ${GOOGLE_CLIENT_ID:}
    client-secret: ${GOOGLE_CLIENT_SECRET:}
    redirect-uri: ${GOOGLE_REDIRECT_URI:}

management:
  tracing:
    sampling:
      probability: ${MANAGEMENT_TRACING_SAMPLING_PROBABILITY:1.0}
  endpoints:
    web:
      exposure:
        include: health,info

ai:
  embedding:
    openai:
      api-key: ${AI_EMBEDDING_OPENAI_API_KEY:${OPENAI_API_KEY:}}
      base-url: ${AI_EMBEDDING_OPENAI_BASE_URL:https://api.openai.com}
  observability:
    enabled: ${AI_OBSERVABILITY_ENABLED:true}
    capture-full-payloads: ${AI_OBSERVABILITY_CAPTURE_FULL_PAYLOADS:false}
    max-payload-chars: ${AI_OBSERVABILITY_MAX_PAYLOAD_CHARS:400}
    langfuse:
      base-url: ${LANGFUSE_BASE_URL:https://cloud.langfuse.com}
      public-key: ${LANGFUSE_PUBLIC_KEY:}
      secret-key: ${LANGFUSE_SECRET_KEY:}

telegram:
  integration:
    enabled: ${TELEGRAM_INTEGRATION_ENABLED:true}
  bot:
    token: ${TELEGRAM_BOT_TOKEN:}
    username: ${TELEGRAM_BOT_USERNAME:}
  webhook:
    url: ${TELEGRAM_WEBHOOK_URL:}
    secret-token: ${TELEGRAM_WEBHOOK_SECRET_TOKEN:}
  links:
    web-base-url: ${BRIEFY_WEB_BASE_URL:http://localhost:3000}
  ingestion:
    worker:
      poll-ms: ${TELEGRAM_INGESTION_WORKER_POLL_MS:5000}
      batch-size: ${TELEGRAM_INGESTION_WORKER_BATCH_SIZE:5}
      max-attempts: ${TELEGRAM_INGESTION_WORKER_MAX_ATTEMPTS:3}

briefing:
  planning:
    enabled: ${BRIEFING_PLANNING_ENABLED:true}
    provider: ${BRIEFING_PLANNING_PROVIDER:google_genai}
    model: ${BRIEFING_PLANNING_MODEL:gemini-3-flash-preview}
  generation:
    enabled: ${BRIEFING_GENERATION_ENABLED:true}
    worker:
      poll-ms: ${BRIEFING_GENERATION_WORKER_POLL_MS:5000}
      batch-size: ${BRIEFING_GENERATION_WORKER_BATCH_SIZE:5}
